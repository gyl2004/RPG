<!--å¥–åŠ±ä¸­å¿ƒé¡µé¢-->
<view class="rewards-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="rewards-header">
    <text class="page-title">å¥–åŠ±ä¸­å¿ƒ</text>
    <view class="currency-display">
      <view class="currency-item">
        <text class="currency-icon">ğŸ’°</text>
        <text class="currency-amount">{{userRewards.coins || 0}}</text>
      </view>
      <view class="currency-item">
        <text class="currency-icon">â­</text>
        <text class="currency-amount">Lv.{{userRewards.level || 1}}</text>
      </view>
    </view>
  </view>

  <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
  <view class="tab-navigation">
    <scroll-view class="tab-scroll" scroll-x="true">
      <view class="tab-list">
        <view 
          class="tab-item {{currentTab === item.id ? 'active' : ''}}"
          wx:for="{{tabs}}"
          wx:key="id"
          data-tab="{{item.id}}"
          bindtap="switchTab"
        >
          <text class="tab-icon">{{item.icon}}</text>
          <text class="tab-text">{{item.name}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æ¦‚è§ˆé¡µé¢ -->
  <view class="tab-content" wx:if="{{currentTab === 'overview'}}">
    <!-- ç­‰çº§è¿›åº¦ -->
    <view class="level-section">
      <text class="section-title">ç­‰çº§è¿›åº¦</text>
      <view class="level-card">
        <view class="level-info">
          <text class="level-current">Lv.{{userRewards.level || 1}}</text>
          <text class="level-next">â†’ Lv.{{(userRewards.level || 1) + 1}}</text>
        </view>
        <view class="exp-progress">
          <view class="exp-bar">
            <view 
              class="exp-fill" 
              style="width: {{userRewards.levelProgress || 0}}%"
            ></view>
          </view>
          <text class="exp-text">
            {{userRewards.currentLevelExp || 0}} / {{userRewards.nextLevelRequiredExp || 100}}
          </text>
        </view>
        <text class="exp-to-next">è¿˜éœ€ {{userRewards.expToNext || 100}} ç»éªŒå‡çº§</text>
      </view>
    </view>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <view class="stats-section">
      <text class="section-title">ç»Ÿè®¡ä¿¡æ¯</text>
      <view class="stats-grid">
        <view class="stat-card">
          <text class="stat-icon">ğŸ’°</text>
          <text class="stat-number">{{userRewards.statistics.totalCoinsEarned || 0}}</text>
          <text class="stat-label">æ€»é‡‘å¸</text>
        </view>
        <view class="stat-card">
          <text class="stat-icon">â­</text>
          <text class="stat-number">{{userRewards.statistics.totalExpEarned || 0}}</text>
          <text class="stat-label">æ€»ç»éªŒ</text>
        </view>
        <view class="stat-card">
          <text class="stat-icon">ğŸ“‹</text>
          <text class="stat-number">{{userRewards.statistics.totalTasksCompleted || 0}}</text>
          <text class="stat-label">å®Œæˆä»»åŠ¡</text>
        </view>
        <view class="stat-card">
          <text class="stat-icon">ğŸ†</text>
          <text class="stat-number">{{userRewards.statistics.achievementsUnlocked || 0}}</text>
          <text class="stat-label">è§£é”æˆå°±</text>
        </view>
      </view>
    </view>
  </view>

  <!-- èƒŒåŒ…é¡µé¢ -->
  <view class="tab-content" wx:if="{{currentTab === 'inventory'}}">
    <view class="inventory-section">
      <text class="section-title">æˆ‘çš„èƒŒåŒ…</text>
      <view class="inventory-grid" wx:if="{{getInventoryItems().length > 0}}">
        <view 
          class="item-card"
          wx:for="{{getInventoryItems()}}"
          wx:key="id"
          wx:for-item="item"
        >
          <view class="item-header">
            <text class="item-icon">{{item.icon}}</text>
            <view class="item-rarity {{item.rarity}}" wx:if="{{itemRarities && itemRarities[item.rarity]}}">
              <text class="rarity-icon">{{itemRarities[item.rarity].icon}}</text>
            </view>
          </view>
          <text class="item-name">{{item.name}}</text>
          <text class="item-description">{{item.description}}</text>
          <view class="item-footer">
            <text class="item-count">x{{item.count}}</text>
            <rpg-button 
              wx:if="{{item.type === 'consumable'}}"
              type="accent" 
              text="ä½¿ç”¨" 
              size="mini"
              data-item-id="{{item.id}}"
              bindtap="useItem"
            />
          </view>
        </view>
      </view>
      <view class="empty-inventory" wx:else>
        <text class="empty-icon">ğŸ’</text>
        <text class="empty-text">èƒŒåŒ…ç©ºç©ºå¦‚ä¹Ÿ</text>
        <text class="empty-hint">å®Œæˆä»»åŠ¡æˆ–è´­ä¹°ç‰©å“æ¥å¡«å……èƒŒåŒ…å§ï¼</text>
      </view>
    </view>
  </view>

  <!-- æˆå°±é¡µé¢ -->
  <view class="tab-content" wx:if="{{currentTab === 'achievements'}}">
    <view class="achievements-section">
      <text class="section-title">æˆå°±ç³»ç»Ÿ</text>
      <view class="achievements-list">
        <view 
          class="achievement-card {{item.isUnlocked ? 'unlocked' : 'locked'}}"
          wx:for="{{getAchievementsList()}}"
          wx:key="id"
          wx:for-item="achievement"
        >
          <view class="achievement-header">
            <text class="achievement-icon">{{achievement.icon}}</text>
            <view class="achievement-info">
              <text class="achievement-name">{{achievement.name}}</text>
              <text class="achievement-description">{{achievement.description}}</text>
            </view>
            <view class="achievement-status">
              <text class="status-icon" wx:if="{{achievement.isUnlocked}}">âœ…</text>
              <text class="status-text" wx:else>{{achievement.progress}}%</text>
            </view>
          </view>
          <view class="achievement-progress" wx:if="{{!achievement.isUnlocked}}">
            <view class="progress-bar">
              <view 
                class="progress-fill" 
                style="width: {{achievement.progress}}%"
              ></view>
            </view>
          </view>
          <view class="achievement-rewards" wx:if="{{achievement.isUnlocked}}">
            <text class="rewards-text">
              å¥–åŠ±ï¼š{{achievement.rewards.coins}}é‡‘å¸ {{achievement.rewards.exp}}ç»éªŒ
            </text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å•†åº—é¡µé¢ -->
  <view class="tab-content" wx:if="{{currentTab === 'shop'}}">
    <view class="shop-section">
      <text class="section-title">ç¥ç§˜å•†åº—</text>
      <view class="shop-grid">
        <view 
          class="shop-item"
          wx:for="{{predefinedItems}}"
          wx:key="id"
          wx:for-item="item"
        >
          <view class="item-header">
            <text class="item-icon">{{item.icon}}</text>
            <view class="item-rarity {{item.rarity}}" wx:if="{{itemRarities && itemRarities[item.rarity]}}">
              <text class="rarity-icon">{{itemRarities[item.rarity].icon}}</text>
            </view>
          </view>
          <text class="item-name">{{item.name}}</text>
          <text class="item-description">{{item.description}}</text>
          <view class="item-footer">
            <view class="item-price">
              <text class="price-icon">ğŸ’°</text>
              <text class="price-amount">{{item.price}}</text>
            </view>
            <rpg-button 
              type="primary" 
              text="è´­ä¹°" 
              size="mini"
              disabled="{{userRewards.coins < item.price}}"
              data-item-id="{{item.id}}"
              bindtap="buyItem"
            />
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>
