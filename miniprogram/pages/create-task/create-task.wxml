<!--åˆ›å»ºä»»åŠ¡é¡µé¢-->
<view class="create-task-container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">åˆ›å»ºæ–°ä»»åŠ¡</text>
    <text class="page-subtitle">è®¾å®šç›®æ ‡ï¼Œå¼€å§‹ä½ çš„å†’é™©ä¹‹æ—…</text>
  </view>

  <!-- ä»»åŠ¡è¡¨å• -->
  <view class="task-form">
    <!-- ä»»åŠ¡æ ‡é¢˜ -->
    <view class="form-section">
      <text class="section-label">ä»»åŠ¡æ ‡é¢˜ *</text>
      <input 
        class="form-input {{errors.title ? 'error' : ''}}"
        placeholder="ç»™ä½ çš„ä»»åŠ¡èµ·ä¸ªåå­—"
        value="{{formData.title}}"
        data-field="title"
        bindinput="onInputChange"
        maxlength="50"
      />
      <text class="error-text" wx:if="{{errors.title}}">{{errors.title}}</text>
    </view>

    <!-- ä»»åŠ¡æè¿° -->
    <view class="form-section">
      <text class="section-label">ä»»åŠ¡æè¿°</text>
      <textarea 
        class="form-textarea"
        placeholder="è¯¦ç»†æè¿°ä½ è¦å®Œæˆçš„ä»»åŠ¡"
        value="{{formData.description}}"
        data-field="description"
        bindinput="onInputChange"
        maxlength="200"
        auto-height
      />
    </view>

    <!-- ä»»åŠ¡åˆ†ç±» -->
    <view class="form-section">
      <text class="section-label">ä»»åŠ¡åˆ†ç±» *</text>
      <view 
        class="form-selector {{errors.category ? 'error' : ''}}"
        bindtap="showCategoryPicker"
      >
        <text class="selector-text {{formData.category ? '' : 'placeholder'}}">
          {{formData.category ? categories[formData.category].name : 'é€‰æ‹©ä»»åŠ¡åˆ†ç±»'}}
        </text>
        <text class="selector-icon">{{formData.category ? categories[formData.category].icon : 'ğŸ“‹'}}</text>
      </view>
      <text class="error-text" wx:if="{{errors.category}}">{{errors.category}}</text>
    </view>

    <!-- ä»»åŠ¡éš¾åº¦ -->
    <view class="form-section">
      <text class="section-label">ä»»åŠ¡éš¾åº¦ *</text>
      <view 
        class="form-selector {{errors.difficulty ? 'error' : ''}}"
        bindtap="showDifficultyPicker"
      >
        <text class="selector-text {{formData.difficulty ? '' : 'placeholder'}}">
          {{formData.difficulty ? difficulties[formData.difficulty].name : 'é€‰æ‹©ä»»åŠ¡éš¾åº¦'}}
        </text>
        <text class="selector-icon">{{formData.difficulty ? difficulties[formData.difficulty].icon : 'â­'}}</text>
      </view>
      <text class="error-text" wx:if="{{errors.difficulty}}">{{errors.difficulty}}</text>
    </view>

    <!-- é¢„ä¼°æ—¶é—´ -->
    <view class="form-section">
      <text class="section-label">é¢„ä¼°æ—¶é—´</text>
      <view class="time-section">
        <text class="time-label">{{formatTime(formData.estimatedTime)}}</text>
        <slider 
          class="time-slider"
          min="5"
          max="480"
          step="5"
          value="{{formData.estimatedTime}}"
          bindchange="onTimeSliderChange"
          activeColor="#3b82f6"
          backgroundColor="rgba(255,255,255,0.2)"
        />
        <view class="time-range">
          <text class="time-min">5åˆ†é’Ÿ</text>
          <text class="time-max">8å°æ—¶</text>
        </view>
      </view>
    </view>

    <!-- è®°å½•æ–¹å¼ -->
    <view class="form-section">
      <text class="section-label">è®°å½•æ–¹å¼</text>
      <view
        class="form-selector"
        bindtap="showVerificationPicker"
      >
        <text class="selector-text" wx:if="{{verificationTypes && verificationTypes[formData.verification]}}">
          {{verificationTypes[formData.verification].name}}
        </text>
        <text class="selector-text placeholder" wx:else>é€‰æ‹©è®°å½•æ–¹å¼</text>
        <text class="selector-icon" wx:if="{{verificationTypes && verificationTypes[formData.verification]}}">
          {{verificationTypes[formData.verification].icon}}
        </text>
        <text class="selector-icon" wx:else>ğŸ“</text>
      </view>
      <text class="form-hint" wx:if="{{verificationTypes && verificationTypes[formData.verification]}}">
        {{verificationTypes[formData.verification].description}}
      </text>
    </view>

    <!-- æˆªæ­¢æ—¥æœŸ -->
    <view class="form-section">
      <text class="section-label">æˆªæ­¢æ—¥æœŸï¼ˆå¯é€‰ï¼‰</text>
      <picker 
        mode="date"
        value="{{formData.deadline}}"
        start="{{today}}"
        bindchange="onDateChange"
      >
        <view class="form-selector">
          <text class="selector-text {{formData.deadline ? '' : 'placeholder'}}">
            {{formData.deadline || 'é€‰æ‹©æˆªæ­¢æ—¥æœŸ'}}
          </text>
          <text class="selector-icon">ğŸ“…</text>
        </view>
      </picker>
    </view>

    <!-- å¤‡æ³¨ -->
    <view class="form-section">
      <text class="section-label">å¤‡æ³¨</text>
      <textarea 
        class="form-textarea"
        placeholder="æ·»åŠ ä¸€äº›å¤‡æ³¨ä¿¡æ¯"
        value="{{formData.notes}}"
        data-field="notes"
        bindinput="onInputChange"
        maxlength="100"
        auto-height
      />
    </view>
  </view>

  <!-- å¥–åŠ±é¢„è§ˆ -->
  <view class="reward-preview" wx:if="{{formData.category && formData.difficulty}}">
    <text class="preview-title">ğŸ å®Œæˆå¥–åŠ±</text>
    <view class="reward-items">
      <view class="reward-item">
        <text class="reward-icon">â­</text>
        <text class="reward-text">{{previewRewards.experience}} ç»éªŒå€¼</text>
      </view>
      <view class="reward-item">
        <text class="reward-icon">ğŸ’°</text>
        <text class="reward-text">{{previewRewards.coins}} é‡‘å¸</text>
      </view>
      <view class="reward-item" wx:if="{{previewRewards.attributeBonus}}">
        <text class="reward-icon">ğŸ“ˆ</text>
        <text class="reward-text">å±æ€§åŠ æˆ</text>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <rpg-button
      type="secondary"
      text="é¢„è§ˆ"
      bindtap="previewTask"
    />
    <rpg-button
      type="primary"
      text="{{loading ? 'åˆ›å»ºä¸­...' : 'åˆ›å»ºä»»åŠ¡'}}"
      bindtap="createTask"
      disabled="{{loading}}"
    />
  </view>

  <!-- åˆ†ç±»é€‰æ‹©å™¨ -->
  <view class="picker-overlay" wx:if="{{showCategoryPicker}}" bindtap="closePicker">
    <view class="picker-modal" catchtap="">
      <view class="picker-header">
        <text class="picker-title">é€‰æ‹©ä»»åŠ¡åˆ†ç±»</text>
      </view>
      <view class="picker-content">
        <view
          class="picker-item"
          wx:for="{{categoriesArray}}"
          wx:key="id"
          data-category="{{item.id}}"
          bindtap="selectCategory"
        >
          <text class="picker-icon">{{item.icon}}</text>
          <view class="picker-info">
            <text class="picker-name">{{item.name}}</text>
            <text class="picker-desc">{{item.description}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- éš¾åº¦é€‰æ‹©å™¨ -->
  <view class="picker-overlay" wx:if="{{showDifficultyPicker}}" bindtap="closePicker">
    <view class="picker-modal" catchtap="">
      <view class="picker-header">
        <text class="picker-title">é€‰æ‹©ä»»åŠ¡éš¾åº¦</text>
      </view>
      <view class="picker-content">
        <view
          class="picker-item"
          wx:for="{{difficultiesArray}}"
          wx:key="id"
          data-difficulty="{{item.id}}"
          bindtap="selectDifficulty"
          style="border-left-color: {{item.color}}"
        >
          <text class="picker-icon">{{item.icon}}</text>
          <view class="picker-info">
            <text class="picker-name">{{item.name}}</text>
            <text class="picker-desc">{{item.description}}</text>
            <text class="picker-multiplier">ç»éªŒå€ç‡: {{item.expMultiplier}}x</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- è®°å½•æ–¹å¼é€‰æ‹©å™¨ -->
  <view class="picker-overlay" wx:if="{{showVerificationPicker}}" bindtap="closePicker">
    <view class="picker-modal" catchtap="">
      <view class="picker-header">
        <text class="picker-title">é€‰æ‹©è®°å½•æ–¹å¼</text>
      </view>
      <view class="picker-content">
        <view
          class="picker-item"
          wx:for="{{verificationTypesArray}}"
          wx:key="id"
          data-verification="{{item.id}}"
          bindtap="selectVerification"
        >
          <text class="picker-icon">{{item.icon}}</text>
          <view class="picker-info">
            <text class="picker-name">{{item.name}}</text>
            <text class="picker-desc">{{item.description}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
