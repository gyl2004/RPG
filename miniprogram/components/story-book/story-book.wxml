<!-- æ•…äº‹ä¹¦UIç»„ä»¶ -->
<view class="story-book-container">
  <!-- è¿›åº¦æ¡ -->
  <view class="story-progress" wx:if="{{showProgress}}">
    <view class="progress-info">
      <text class="progress-label">æ•…äº‹è¿›åº¦</text>
      <text class="progress-value">{{formatProgress(progress.totalProgress)}}%</text>
    </view>
    <view class="progress-bar">
      <view class="progress-fill" style="width: {{progress.totalProgress || 0}}%"></view>
    </view>
  </view>

  <!-- æ—¶é—´çº¿æ¨¡å¼ -->
  <view class="timeline-mode" wx:if="{{mode === 'timeline'}}">
    <view class="timeline-container">
      <view 
        class="timeline-item {{getChapterStatus(chapter)}}"
        wx:for="{{chapters}}"
        wx:key="id"
        wx:for-item="chapter"
        data-chapter-id="{{chapter.id}}"
        bindtap="onChapterTap"
      >
        <view class="timeline-marker">
          <view class="marker-dot">
            <text class="marker-icon">{{getChapterIcon(chapter)}}</text>
          </view>
          <view class="marker-line" wx:if="{{index < chapters.length - 1}}"></view>
        </view>
        
        <view class="timeline-content">
          <view class="chapter-header">
            <text class="chapter-title">{{chapter.title}}</text>
            <view class="chapter-type {{chapter.type}}">
              <text class="type-text">{{chapter.type}}</text>
            </view>
          </view>
          <text class="chapter-description">{{chapter.description}}</text>
          <view class="chapter-meta" wx:if="{{getChapterStatus(chapter) !== 'locked'}}">
            <text class="chapter-order">ç¬¬{{chapter.order}}ç« </text>
            <view class="chapter-rewards" wx:if="{{chapter.rewards}}">
              <text class="reward-item" wx:if="{{chapter.rewards.coins}}">ğŸ’°{{chapter.rewards.coins}}</text>
              <text class="reward-item" wx:if="{{chapter.rewards.experience}}">â­{{chapter.rewards.experience}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ä¹¦æœ¬æ¨¡å¼ -->
  <view class="book-mode" wx:if="{{mode === 'book'}}">
    <view class="book-container {{bookOpen ? 'open' : 'closed'}}" bindtap="toggleBook">
      <view class="book-cover" wx:if="{{!bookOpen}}">
        <view class="cover-content">
          <text class="book-title">æˆ‘çš„æˆé•¿æ•…äº‹</text>
          <text class="book-subtitle">{{chapters.length}}ä¸ªç« èŠ‚çš„å†’é™©ä¹‹æ—…</text>
          <view class="cover-decoration">
            <text class="decoration-icon">ğŸ“–</text>
          </view>
          <text class="open-hint">ç‚¹å‡»æ‰“å¼€</text>
        </view>
      </view>
      
      <view class="book-pages" wx:if="{{bookOpen}}">
        <view class="page-container {{isAnimating ? 'animating' : ''}}">
          <!-- å·¦é¡µ -->
          <view class="page left-page" wx:if="{{hasPrevPage()}}">
            <view class="page-content">
              <text class="page-number">{{currentPage}}</text>
              <view class="chapter-preview">
                <text class="preview-title">ä¸Šä¸€ç« </text>
                <text class="preview-content">{{chapters[currentPage - 1].title}}</text>
              </view>
            </view>
          </view>
          
          <!-- å³é¡µ -->
          <view class="page right-page">
            <view class="page-content" wx:if="{{getCurrentChapter()}}">
              <text class="page-number">{{currentPage + 1}}</text>
              <view class="chapter-full">
                <text class="chapter-title">{{getCurrentChapter().title}}</text>
                <text class="chapter-content">{{getCurrentChapter().content}}</text>
                <view class="chapter-status">
                  <text class="status-text">çŠ¶æ€ï¼š{{getChapterStatus(getCurrentChapter()) === 'completed' ? 'å·²å®Œæˆ' : getChapterStatus(getCurrentChapter()) === 'unlocked' ? 'å¯é˜…è¯»' : 'æœªè§£é”'}}</text>
                </view>
              </view>
            </view>
          </view>
        </view>
        
        <!-- ç¿»é¡µæ§åˆ¶ -->
        <view class="page-controls">
          <view class="control-btn prev-btn {{!hasPrevPage() ? 'disabled' : ''}}" bindtap="prevPage">
            <text class="control-icon">â€¹</text>
          </view>
          <view class="page-indicator">
            <text class="current-page">{{currentPage + 1}}</text>
            <text class="total-pages">/ {{chapters.length}}</text>
          </view>
          <view class="control-btn next-btn {{!hasNextPage() ? 'disabled' : ''}}" bindtap="nextPage">
            <text class="control-icon">â€º</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å¡ç‰‡æ¨¡å¼ -->
  <view class="card-mode" wx:if="{{mode === 'card'}}">
    <view class="cards-container">
      <view 
        class="story-card {{getChapterStatus(chapter)}}"
        wx:for="{{chapters}}"
        wx:key="id"
        wx:for-item="chapter"
        data-chapter-id="{{chapter.id}}"
        bindtap="onChapterTap"
      >
        <view class="card-header">
          <view class="card-icon">
            <text class="icon-text">{{getChapterIcon(chapter)}}</text>
          </view>
          <view class="card-info">
            <text class="card-title">{{chapter.title}}</text>
            <text class="card-type">{{chapter.type}}</text>
          </view>
          <view class="card-order">
            <text class="order-text">{{chapter.order}}</text>
          </view>
        </view>
        
        <view class="card-content">
          <text class="card-description">{{chapter.description}}</text>
        </view>
        
        <view class="card-footer" wx:if="{{getChapterStatus(chapter) !== 'locked'}}">
          <view class="card-rewards" wx:if="{{chapter.rewards}}">
            <text class="reward-label">å¥–åŠ±ï¼š</text>
            <text class="reward-value" wx:if="{{chapter.rewards.coins}}">{{chapter.rewards.coins}}é‡‘å¸</text>
            <text class="reward-value" wx:if="{{chapter.rewards.experience}}">{{chapter.rewards.experience}}ç»éªŒ</text>
          </view>
          <view class="card-status">
            <text class="status-badge {{getChapterStatus(chapter)}}">
              {{getChapterStatus(chapter) === 'completed' ? 'å·²å®Œæˆ' : getChapterStatus(chapter) === 'unlocked' ? 'å¯é˜…è¯»' : 'æœªè§£é”'}}
            </text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-story" wx:if="{{chapters.length === 0}}">
    <text class="empty-icon">ğŸ“š</text>
    <text class="empty-text">æš‚æ— æ•…äº‹ç« èŠ‚</text>
    <text class="empty-hint">å¼€å§‹ä½ çš„å†’é™©ä¹‹æ—…ï¼Œåˆ›é€ å±äºè‡ªå·±çš„æ•…äº‹ï¼</text>
  </view>
</view>
