<!--æŠ€èƒ½æ ‘é¡µé¢-->
<view class="skills-container">
  <!-- æŠ€èƒ½ç‚¹ä¿¡æ¯ -->
  <view class="skill-points-header">
    <view class="points-info">
      <text class="points-icon">â­</text>
      <text class="points-text">å¯ç”¨æŠ€èƒ½ç‚¹: {{availableSkillPoints}}</text>
    </view>
    <view class="header-actions">
      <rpg-button 
        type="secondary" 
        text="æŸ¥çœ‹æ•ˆæœ" 
        size="small"
        bindtap="viewSkillEffects"
      />
      <rpg-button 
        type="accent" 
        text="è·å¾—æŠ€èƒ½ç‚¹" 
        size="small"
        bindtap="gainSkillPoints"
      />
    </view>
  </view>

  <!-- æŠ€èƒ½æ ‘é€‰æ‹© -->
  <view class="skill-tree-tabs">
    <scroll-view scroll-x="true" class="tabs-scroll">
      <view class="tabs-container">
        <view 
          class="tree-tab {{currentTree === item ? 'active' : ''}}" 
          wx:for="{{Object.keys(skillTrees)}}" 
          wx:key="*this"
          data-tree="{{item}}"
          bindtap="switchSkillTree"
          style="border-color: {{skillTrees[item].color}}"
        >
          <text class="tab-icon">{{skillTrees[item].icon}}</text>
          <text class="tab-name">{{skillTrees[item].name}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- å½“å‰æŠ€èƒ½æ ‘ -->
  <view class="current-skill-tree" wx:if="{{skillTrees[currentTree]}}">
    <view class="tree-header">
      <text class="tree-title">{{skillTrees[currentTree].name}}</text>
      <text class="tree-description">{{skillTrees[currentTree].description}}</text>
    </view>

    <!-- æŠ€èƒ½åˆ—è¡¨ -->
    <view class="skills-list">
      <view 
        class="skill-item {{getSkillStatusClass(skill, currentTree)}}" 
        wx:for="{{Object.values(skillTrees[currentTree].skills)}}" 
        wx:key="id"
        wx:for-item="skill"
        data-skill="{{skill.id}}"
        data-tree="{{currentTree}}"
        bindtap="showSkillDetail"
      >
        <!-- æŠ€èƒ½å›¾æ ‡å’Œç­‰çº§ -->
        <view class="skill-icon-container">
          <text class="skill-icon">{{skill.icon}}</text>
          <view class="skill-level" wx:if="{{getSkillCurrentLevel(skill.id) > 0}}">
            <text class="level-text">{{getSkillCurrentLevel(skill.id)}}</text>
          </view>
        </view>

        <!-- æŠ€èƒ½ä¿¡æ¯ -->
        <view class="skill-info">
          <text class="skill-name">{{skill.name}}</text>
          <text class="skill-description">{{skill.description}}</text>
          
          <!-- æŠ€èƒ½è¿›åº¦ -->
          <view class="skill-progress">
            <text class="progress-text">
              {{getSkillCurrentLevel(skill.id)}}/{{skill.maxLevel}}
            </text>
            <view class="progress-bar">
              <view 
                class="progress-fill" 
                style="width: {{(getSkillCurrentLevel(skill.id) / skill.maxLevel) * 100}}%; background-color: {{skillTrees[currentTree].color}}"
              ></view>
            </view>
          </view>

          <!-- æŠ€èƒ½ç‚¹æ¶ˆè€— -->
          <view class="skill-cost">
            <text class="cost-icon">â­</text>
            <text class="cost-text">{{skill.skillPoints}} æŠ€èƒ½ç‚¹</text>
          </view>
        </view>

        <!-- æŠ€èƒ½çŠ¶æ€æŒ‡ç¤º -->
        <view class="skill-status">
          <text class="status-icon" wx:if="{{getSkillCurrentLevel(skill.id) >= skill.maxLevel}}">âœ…</text>
          <text class="status-icon" wx:elif="{{getSkillCurrentLevel(skill.id) > 0}}">ğŸ“ˆ</text>
          <text class="status-icon" wx:else>ğŸ”’</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æŠ€èƒ½è¯¦æƒ…æ¨¡æ€æ¡† -->
  <view class="modal-overlay" wx:if="{{showSkillModal}}" bindtap="closeSkillModal">
    <view class="skill-modal" catchtap="">
      <view class="modal-header">
        <text class="modal-title">{{selectedSkill.name}}</text>
        <text class="modal-icon">{{selectedSkill.icon}}</text>
      </view>

      <view class="modal-content">
        <!-- æŠ€èƒ½æè¿° -->
        <text class="skill-description-full">{{selectedSkill.description}}</text>

        <!-- å½“å‰ç­‰çº§ -->
        <view class="current-level-info">
          <text class="level-label">å½“å‰ç­‰çº§</text>
          <text class="level-value">{{selectedSkill.currentLevel}}/{{selectedSkill.maxLevel}}</text>
        </view>

        <!-- ç­‰çº§è¿›åº¦æ¡ -->
        <view class="level-progress-bar">
          <view 
            class="level-progress-fill" 
            style="width: {{(selectedSkill.currentLevel / selectedSkill.maxLevel) * 100}}%; background-color: {{skillTrees[selectedSkill.treeType].color}}"
          ></view>
        </view>

        <!-- æŠ€èƒ½è¦æ±‚ -->
        <view class="skill-requirements">
          <text class="requirements-title">å­¦ä¹ è¦æ±‚</text>
          <view class="requirements-list">
            <text class="requirement-item">ç­‰çº§: {{selectedSkill.requirements.level}}</text>
            <text
              class="requirement-item"
              wx:for="{{selectedSkill.attributeRequirements}}"
              wx:key="name"
            >
              {{item.name}}: {{item.value}}
            </text>
            <text
              class="requirement-item"
              wx:for="{{selectedSkill.skillRequirements}}"
              wx:key="name"
            >
              å‰ç½®æŠ€èƒ½: {{item.name}} Lv.{{item.level}}
            </text>
          </view>
        </view>

        <!-- æŠ€èƒ½æ•ˆæœ -->
        <view class="skill-effects">
          <text class="effects-title">æŠ€èƒ½æ•ˆæœ</text>
          <view class="effects-list">
            <text
              class="effect-item"
              wx:for="{{selectedSkill.effectsList}}"
              wx:key="name"
            >
              {{item.name}}: {{item.value}}
            </text>
          </view>
        </view>

        <!-- æ¶ˆè€—ä¿¡æ¯ -->
        <view class="skill-cost-info">
          <text class="cost-label">æ¶ˆè€—æŠ€èƒ½ç‚¹</text>
          <text class="cost-value">{{selectedSkill.skillPoints}}</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="modal-actions">
        <rpg-button 
          type="primary" 
          text="å­¦ä¹ æŠ€èƒ½" 
          size="small"
          bindtap="learnSkill"
          wx:if="{{selectedSkill.canLearn && availableSkillPoints >= selectedSkill.skillPoints}}"
        />
        <rpg-button 
          type="secondary" 
          text="{{selectedSkill.isMaxLevel ? 'å·²æ»¡çº§' : selectedSkill.requirementReason || 'æ¡ä»¶ä¸è¶³'}}" 
          size="small"
          disabled="true"
          wx:else
        />
        <rpg-button 
          type="secondary" 
          text="å…³é—­" 
          size="small"
          bindtap="closeSkillModal"
        />
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-overlay">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>
</view>
