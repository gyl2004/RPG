<!--å‡çº§åŠ¨ç”»æ¨¡æ€æ¡†-->
<view class="level-up-overlay" wx:if="{{show}}" bindtap="closeModal">
  <view class="level-up-container {{animationClass}}" catchtap="">
    
    <!-- å‡çº§åŠ¨ç”»é˜¶æ®µ -->
    <view class="level-up-animation" wx:if="{{animationStep === 1}}">
      <view class="level-up-burst">
        <view class="burst-ring ring-1"></view>
        <view class="burst-ring ring-2"></view>
        <view class="burst-ring ring-3"></view>
      </view>
      
      <view class="level-up-text">
        <text class="level-up-title">LEVEL UP!</text>
        <text class="level-change">{{levelUpData.oldLevel}} â†’ {{levelUpData.newLevel}}</text>
      </view>
      
      <view class="level-up-effects">
        <view class="effect-particle" wx:for="{{[1,2,3,4,5,6,7,8]}}" wx:key="*this"></view>
      </view>
    </view>

    <!-- å¥–åŠ±å±•ç¤ºé˜¶æ®µ -->
    <view class="rewards-display" wx:if="{{animationStep === 2}}">
      <view class="rewards-header">
        <text class="rewards-title">ğŸ‰ å‡çº§å¥–åŠ± ğŸ‰</text>
        <text class="level-info">æ­å–œå‡çº§åˆ° {{levelUpData.newLevel}} çº§ï¼</text>
      </view>

      <view class="rewards-list">
        <!-- å±æ€§ç‚¹å¥–åŠ± -->
        <view class="reward-item attribute-points" wx:if="{{levelUpData.attributePoints > 0}}">
          <view class="reward-icon">ğŸ¯</view>
          <view class="reward-content">
            <text class="reward-name">å±æ€§ç‚¹</text>
            <text class="reward-amount">+{{levelUpData.attributePoints}}</text>
          </view>
        </view>

        <!-- æŠ€èƒ½ç‚¹å¥–åŠ± -->
        <view class="reward-item skill-points" wx:if="{{levelUpData.skillPoints > 0}}">
          <view class="reward-icon">â­</view>
          <view class="reward-content">
            <text class="reward-name">æŠ€èƒ½ç‚¹</text>
            <text class="reward-amount">+{{levelUpData.skillPoints}}</text>
          </view>
        </view>

        <!-- ç»éªŒå€¼å¥–åŠ± -->
        <view class="reward-item experience" wx:if="{{levelUpData.expGain > 0}}">
          <view class="reward-icon">âœ¨</view>
          <view class="reward-content">
            <text class="reward-name">ç»éªŒå€¼</text>
            <text class="reward-amount">+{{levelUpData.expGain}}</text>
          </view>
        </view>

        <!-- ç‰©å“å¥–åŠ± -->
        <view 
          class="reward-item item" 
          wx:for="{{levelUpData.rewards.items}}" 
          wx:key="id"
          data-reward="{{item}}"
          bindtap="viewRewardDetail"
        >
          <view class="reward-icon">{{item.icon}}</view>
          <view class="reward-content">
            <text class="reward-name">{{item.name}}</text>
            <text class="reward-desc">{{item.description}}</text>
          </view>
        </view>

        <!-- æŠ€èƒ½ç‚¹å¥–åŠ± -->
        <view 
          class="reward-item skill" 
          wx:for="{{levelUpData.rewards.skills}}" 
          wx:key="id"
        >
          <view class="reward-icon">{{item.icon}}</view>
          <view class="reward-content">
            <text class="reward-name">{{item.name}}</text>
            <text class="reward-desc">{{item.description}}</text>
          </view>
        </view>

        <!-- ç§°å·å¥–åŠ± -->
        <view 
          class="reward-item title" 
          wx:for="{{levelUpData.rewards.titles}}" 
          wx:key="*this"
        >
          <view class="reward-icon">ğŸ‘‘</view>
          <view class="reward-content">
            <text class="reward-name">æ–°ç§°å·</text>
            <text class="reward-title">{{item}}</text>
          </view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="rewards-actions">
        <rpg-button 
          type="secondary" 
          text="åˆ†äº«æˆå°±" 
          size="small"
          bindtap="shareAchievement"
        />
        <rpg-button 
          type="primary" 
          text="ç»§ç»­å†’é™©" 
          size="small"
          bindtap="continueAdventure"
        />
      </view>
    </view>

    <!-- å…³é—­æŒ‰é’® -->
    <view class="close-button" bindtap="closeModal">
      <text class="close-icon">Ã—</text>
    </view>
  </view>
</view>
