# 云函数部署说明

## 当前状态
目前小程序已经实现了**离线模式**，可以在不部署云函数的情况下正常运行基础功能。

## 功能说明

### 已实现的离线功能
- ✅ 微信登录（使用本地临时ID）
- ✅ 用户信息管理
- ✅ 角色数据管理
- ✅ 本地数据存储
- ✅ 用户设置管理
- ✅ 基础的游戏化功能

### 需要云函数的高级功能
- 🔄 真实的用户身份验证（获取真实openid）
- 🔄 云端数据同步
- 🔄 多设备数据共享
- 🔄 用户数据备份
- 🔄 社交功能
- 🔄 排行榜功能

## 云函数部署步骤

### 1. 在微信开发者工具中部署云函数

1. 右键点击 `cloudfunctions/rpgFunctions` 文件夹
2. 选择"上传并部署：云端安装依赖"
3. 等待部署完成

### 2. 配置云函数权限

确保云函数配置文件 `config.json` 包含以下权限：

```json
{
  "permissions": {
    "openapi": [
      "subscribeMessage.send",
      "templateMessage.send",
      "auth.code2Session"
    ]
  }
}
```

### 3. 测试云函数

部署完成后，可以在微信开发者工具的云开发控制台中测试云函数：

1. 打开云开发控制台
2. 进入云函数管理
3. 找到 `rpgFunctions` 函数
4. 点击"测试"按钮
5. 输入测试数据：
```json
{
  "type": "test",
  "data": {}
}
```

### 4. 启用云端功能

云函数部署成功后，小程序会自动检测并使用云端功能：

- 登录时会获取真实的openid
- 用户数据会同步到云数据库
- 支持多设备数据共享

## 故障排除

### 常见问题

1. **云函数部署失败**
   - 检查网络连接
   - 确保云开发环境已开通
   - 检查云函数代码语法

2. **权限不足**
   - 确保 `config.json` 配置正确
   - 重新部署云函数

3. **调用失败**
   - 检查云开发环境ID是否正确
   - 确保云函数已成功部署
   - 查看云函数日志

### 查看日志

在云开发控制台的云函数管理中，可以查看函数调用日志：

1. 进入云函数管理
2. 点击函数名称
3. 查看"调用日志"标签页

## 开发模式 vs 生产模式

### 开发模式（当前）
- 使用本地临时ID
- 数据仅存储在本地
- 适合开发和测试

### 生产模式（部署云函数后）
- 使用真实的微信openid
- 数据同步到云端
- 支持完整的用户体验

## 注意事项

1. 云函数部署需要网络连接
2. 首次部署可能需要较长时间
3. 建议在开发环境中先测试云函数
4. 生产环境部署前请充分测试

## 联系支持

如果遇到部署问题，可以：

1. 查看微信开发者工具的控制台输出
2. 检查云开发控制台的错误日志
3. 参考微信小程序云开发官方文档
