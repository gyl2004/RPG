<!-- AIä»»åŠ¡æ¨èé¡µé¢ -->
<view class="ai-tasks-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-content">
      <text class="page-title">ğŸ¤– AIæ™ºèƒ½æ¨è</text>
      <text class="page-subtitle">åŸºäºä½ çš„è¡Œä¸ºæ¨¡å¼å’Œåå¥½ï¼Œä¸ºä½ é‡èº«å®šåˆ¶ä»»åŠ¡</text>
      <view class="ai-model-info">
        <text class="model-name">GPT-3.5 Turbo</text>
        <text class="model-badge stable">ç¨³å®šç‰ˆ</text>
      </view>
    </view>
    <view class="header-actions">
      <rpg-button
        type="secondary"
        text="{{refreshing ? 'ç”Ÿæˆä¸­...' : 'ğŸ¤– AIé‡æ–°ç”Ÿæˆ'}}"
        size="small"
        disabled="{{refreshing}}"
        bindtap="generateRealAIRecommendations"
      />
      <rpg-button
        type="tertiary"
        text="ğŸ”„ é‡ç½®çŠ¶æ€"
        size="small"
        bindtap="resetRecommendationStatus"
      />
    </view>
  </view>

  <!-- ç”¨æˆ·çŠ¶æ€æ¦‚è§ˆ -->
  <view class="status-overview" wx:if="{{emotionalState.metrics}}">
    <text class="overview-title">å½“å‰çŠ¶æ€åˆ†æ</text>
    <view class="status-grid">
      <view class="status-item">
        <text class="status-label">æƒ…æ„ŸçŠ¶æ€</text>
        <text class="status-value">{{emotionalState.primaryEmotion === 'joyful' ? 'ğŸ˜Š å¿«ä¹' : emotionalState.primaryEmotion === 'energetic' ? 'âš¡ å……æ»¡æ´»åŠ›' : emotionalState.primaryEmotion === 'confident' ? 'ğŸ’ª è‡ªä¿¡' : 'ğŸ˜Œ å¹³è¡¡'}}</text>
      </view>
      <view class="status-item">
        <text class="status-label">åŠ¨åŠ›å€¼</text>
        <text class="status-value">{{formatEmotionValue(emotionalState.metrics.motivation)}}</text>
      </view>
      <view class="status-item">
        <text class="status-label">è§’è‰²ç±»å‹</text>
        <text class="status-value">{{userProfile.characterType === 'warrior' ? 'âš”ï¸ å‹‡å£«' : userProfile.characterType === 'scholar' ? 'ğŸ“š å­¦è€…' : userProfile.characterType === 'artist' ? 'ğŸ¨ è‰ºæœ¯å®¶' : userProfile.characterType === 'socialite' ? 'ğŸ‘¥ ç¤¾äº¤å®¶' : 'ğŸ—ºï¸ æ¢é™©å®¶'}}</text>
      </view>
    </view>
  </view>

  <!-- AIæ¨èä»»åŠ¡åˆ—è¡¨ -->
  <view class="recommendations-section">
    <view class="section-header">
      <text class="section-title">ä¸ºä½ æ¨èçš„ä»»åŠ¡</text>
      <text class="section-count" wx:if="{{aiTaskRecommendations.length > 0}}">{{aiTaskRecommendations.length}}ä¸ªæ¨è</text>
    </view>

    <!-- ä»»åŠ¡åˆ—è¡¨ -->
    <view class="tasks-list" wx:if="{{aiTaskRecommendations.length > 0}}">
      <view 
        class="ai-task-card"
        wx:for="{{aiTaskRecommendations}}"
        wx:key="id"
        wx:for-item="task"
        wx:for-index="index"
        data-task-index="{{index}}"
        bindtap="viewTaskDetail"
      >
        <!-- ä»»åŠ¡å¤´éƒ¨ -->
        <view class="task-header">
          <view class="task-info">
            <text class="task-title">{{task.title}}</text>
            <text class="task-description">{{task.description}}</text>
          </view>
          <view class="task-meta">
            <view class="difficulty-badge {{task.difficulty}}">
              <text class="difficulty-text">{{getDifficultyText(task.difficulty)}}</text>
            </view>
            <view class="priority-indicator">
              <text class="priority-text">ä¼˜å…ˆçº§ {{task.priority}}</text>
            </view>
          </view>
        </view>

        <!-- ä»»åŠ¡è¯¦æƒ… -->
        <view class="task-details">
          <view class="task-stats">
            <view class="stat-item">
              <text class="stat-icon">â±ï¸</text>
              <text class="stat-text">{{task.estimatedTime}}åˆ†é’Ÿ</text>
            </view>
            <view class="stat-item">
              <text class="stat-icon">ğŸ’°</text>
              <text class="stat-text">{{task.estimatedReward.coins}}é‡‘å¸</text>
            </view>
            <view class="stat-item">
              <text class="stat-icon">â­</text>
              <text class="stat-text">{{task.estimatedReward.experience}}ç»éªŒ</text>
            </view>
          </view>
          
          <view class="task-tags" wx:if="{{task.tags}}">
            <text 
              class="task-tag"
              wx:for="{{task.tags}}"
              wx:key="*this"
              wx:for-item="tag"
            >#{{tag}}</text>
          </view>
        </view>

        <!-- AIæ¨èç†ç”± -->
        <view class="ai-reason">
          <text class="reason-icon">ğŸ’¡</text>
          <text class="reason-text">{{task.personalizedReason}}</text>
        </view>

        <!-- æ“ä½œæŒ‰é’® -->
        <view class="task-actions">
          <rpg-button
            wx:if="{{!task.isCreated}}"
            type="primary"
            text="åˆ›å»ºä»»åŠ¡"
            size="small"
            data-task-index="{{index}}"
            bindtap="createAITask"
            catchtap="true"
          />
          <view wx:else class="task-created">
            <text class="created-icon">âœ…</text>
            <text class="created-text">å·²åˆ›å»º</text>
            <rpg-button
              type="secondary"
              text="æŸ¥çœ‹ä»»åŠ¡"
              size="small"
              bindtap="goToTasks"
              catchtap="true"
            />
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-recommendations" wx:else>
      <view class="empty-content">
        <text class="empty-icon">ğŸ¤–</text>
        <text class="empty-title">AIæ­£åœ¨ä¸ºä½ åˆ†æ</text>
        <text class="empty-description">
          åŸºäºä½ çš„è¡Œä¸ºæ¨¡å¼ã€æƒ…æ„ŸçŠ¶æ€å’Œè§’è‰²ç±»å‹ï¼ŒAIå°†ä¸ºä½ ç”Ÿæˆä¸ªæ€§åŒ–çš„ä»»åŠ¡æ¨èã€‚
          <br/>è¯·ç¨ç­‰ç‰‡åˆ»æˆ–ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ç«‹å³ç”Ÿæˆã€‚
        </text>
        
        <view class="rate-limit-notice">
          <text class="rate-limit-text">ğŸ’¡ ä½¿ç”¨ChatAnywhereæä¾›çš„GPT-3.5æœåŠ¡</text>
        </view>

        <view class="empty-actions">
          <rpg-button
            type="primary"
            text="ğŸ¤– ä½¿ç”¨çœŸå®AIç”Ÿæˆ"
            bindtap="generateRealAIRecommendations"
          />
          <rpg-button
            type="secondary"
            text="ğŸ“‹ æŸ¥çœ‹æµ‹è¯•æ¨è"
            bindtap="generateTestRecommendations"
          />
          <rpg-button
            type="tertiary"
            text="ğŸ”§ AIåŠŸèƒ½æµ‹è¯•"
            bindtap="goToAITest"
          />
        </view>
      </view>
    </view>
  </view>

  <!-- AIæ¨èè¯´æ˜ -->
  <view class="ai-explanation">
    <text class="explanation-title">ğŸ§  AIæ¨èåŸç†</text>
    <view class="explanation-content">
      <view class="explanation-item">
        <text class="explanation-icon">ğŸ“Š</text>
        <text class="explanation-text">åˆ†æä½ çš„æƒ…æ„ŸçŠ¶æ€å’ŒåŠ¨åŠ›æ°´å¹³</text>
      </view>
      <view class="explanation-item">
        <text class="explanation-icon">ğŸ­</text>
        <text class="explanation-text">åŸºäºä½ çš„è§’è‰²ç±»å‹ç‰¹å¾</text>
      </view>
      <view class="explanation-item">
        <text class="explanation-icon">ğŸ“ˆ</text>
        <text class="explanation-text">è€ƒè™‘ä½ çš„æˆé•¿éœ€æ±‚å’Œå¼±é¡¹</text>
      </view>
      <view class="explanation-item">
        <text class="explanation-icon">ğŸ•</text>
        <text class="explanation-text">åŒ¹é…ä½ çš„æ´»è·ƒæ—¶é—´åå¥½</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">AIæ­£åœ¨åˆ†æä¸­...</text>
    </view>
  </view>
</view>
