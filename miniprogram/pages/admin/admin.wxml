<!--æ•°æ®åº“ç®¡ç†é¡µé¢-->
<view class="admin-container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="admin-header">
    <text class="admin-title">æ•°æ®åº“ç®¡ç†</text>
    <text class="admin-subtitle">å¼€å‘å·¥å…· - ä»…é™ç®¡ç†å‘˜ä½¿ç”¨</text>
  </view>

  <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
  <view class="admin-actions">
    <rpg-button
      type="primary"
      text="åˆå§‹åŒ–æ•°æ®åº“"
      loading="{{loading}}"
      bindtap="initializeDatabase"
    />
    <rpg-button
      type="secondary"
      text="åˆ›å»ºç´¢å¼•"
      bindtap="createIndexes"
    />
    <rpg-button
      type="warning"
      text="æµ‹è¯•äº‘å‡½æ•°"
      bindtap="testCloudFunction"
    />
    <rpg-button
      type="danger"
      text="æ¸…ç©ºæ•°æ®åº“"
      bindtap="clearDatabase"
    />
  </view>

  <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
  <view class="tab-nav">
    <view
      class="tab-item {{activeTab === 'status' ? 'active' : ''}}"
      data-tab="status"
      bindtap="switchTab"
    >
      æ•°æ®åº“çŠ¶æ€
    </view>
    <view
      class="tab-item {{activeTab === 'indexes' ? 'active' : ''}}"
      data-tab="indexes"
      bindtap="switchTab"
    >
      ç´¢å¼•ç®¡ç†
    </view>
    <view
      class="tab-item {{activeTab === 'security' ? 'active' : ''}}"
      data-tab="security"
      bindtap="switchTab"
    >
      å®‰å…¨è§„åˆ™
    </view>
    <view
      class="tab-item {{activeTab === 'models' ? 'active' : ''}}"
      data-tab="models"
      bindtap="switchTab"
    >
      æ¨¡å‹æ¥å£
    </view>
    <view
      class="tab-item {{activeTab === 'logs' ? 'active' : ''}}"
      data-tab="logs"
      bindtap="switchTab"
    >
      æ“ä½œæ—¥å¿—
    </view>
  </view>

  <!-- æ•°æ®åº“çŠ¶æ€æ ‡ç­¾é¡µ -->
  <view wx:if="{{activeTab === 'status'}}" class="tab-content">
    <view class="status-section">
      <view class="section-header">
        <text class="section-title">æ•°æ®åº“çŠ¶æ€</text>
        <view class="status-actions">
          <text class="action-btn" bindtap="exportStatus">å¯¼å‡º</text>
          <text class="action-btn" bindtap="refreshStatus">åˆ·æ–°</text>
        </view>
      </view>

      <view class="status-grid">
        <view
          class="status-item"
          wx:for="{{dbStatus}}"
          wx:key="index"
          data-collection="{{index}}"
          bindtap="viewCollectionDetails"
        >
          <view class="status-name">{{index}}</view>
          <view class="status-count {{item === 'error' ? 'error' : ''}}">
            {{item === 'error' ? 'é”™è¯¯' : item + ' æ¡'}}
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç´¢å¼•ç®¡ç†æ ‡ç­¾é¡µ -->
  <view wx:if="{{activeTab === 'indexes'}}" class="tab-content">
    <view class="indexes-section">
      <view class="section-header">
        <text class="section-title">ç´¢å¼•æ¨è</text>
        <view class="status-actions">
          <text class="action-btn" bindtap="generateIndexScript">ç”Ÿæˆè„šæœ¬</text>
          <text class="action-btn" bindtap="createIndexes">åˆ›å»ºç´¢å¼•</text>
        </view>
      </view>

      <view class="indexes-grid">
        <view
          class="index-item"
          wx:for="{{indexRecommendations}}"
          wx:key="index"
          data-collection="{{index}}"
          bindtap="viewIndexDetails"
        >
          <view class="index-collection">{{index}}</view>
          <view class="index-count">{{item.length}} ä¸ªæ¨èç´¢å¼•</view>
          <view class="index-preview">
            <text
              class="index-field"
              wx:for="{{item}}"
              wx:for-item="indexItem"
              wx:key="field"
            >
              {{indexItem.field}}
            </text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å®‰å…¨è§„åˆ™æ ‡ç­¾é¡µ -->
  <view wx:if="{{activeTab === 'security'}}" class="tab-content">
    <view class="security-section">
      <view class="section-header">
        <text class="section-title">å®‰å…¨è§„åˆ™</text>
        <view class="status-actions">
          <text class="action-btn" bindtap="generateSecurityScript">ç”Ÿæˆè„šæœ¬</text>
          <text class="action-btn" bindtap="validateSecurityRules">éªŒè¯è§„åˆ™</text>
        </view>
      </view>

      <!-- å®‰å…¨æ‘˜è¦ -->
      <view class="security-summary">
        <view class="summary-item">
          <text class="summary-label">æ€»é›†åˆæ•°</text>
          <text class="summary-value">{{securitySummary.totalCollections}}</text>
        </view>
        <view class="summary-item">
          <text class="summary-label">åªè¯»é›†åˆ</text>
          <text class="summary-value">{{securitySummary.readOnlyCollections}}</text>
        </view>
        <view class="summary-item">
          <text class="summary-label">ç”¨æˆ·æ•°æ®é›†åˆ</text>
          <text class="summary-value">{{securitySummary.userDataCollections}}</text>
        </view>
        <view class="summary-item">
          <text class="summary-label">ç³»ç»Ÿæ•°æ®é›†åˆ</text>
          <text class="summary-value">{{securitySummary.systemDataCollections}}</text>
        </view>
      </view>

      <!-- éªŒè¯ç»“æœ -->
      <view wx:if="{{securitySummary.validation}}" class="validation-result">
        <view class="validation-status {{securitySummary.validation.valid ? 'valid' : 'invalid'}}">
          {{securitySummary.validation.valid ? 'âœ“ éªŒè¯é€šè¿‡' : 'âœ— éªŒè¯å¤±è´¥'}}
        </view>
        <view wx:if="{{securitySummary.validation.errors.length > 0}}" class="validation-errors">
          <text class="validation-title">é”™è¯¯ ({{securitySummary.validation.errors.length}})</text>
          <text
            class="validation-item error"
            wx:for="{{securitySummary.validation.errors}}"
            wx:key="*this"
          >
            {{item}}
          </text>
        </view>
        <view wx:if="{{securitySummary.validation.warnings.length > 0}}" class="validation-warnings">
          <text class="validation-title">è­¦å‘Š ({{securitySummary.validation.warnings.length}})</text>
          <text
            class="validation-item warning"
            wx:for="{{securitySummary.validation.warnings}}"
            wx:key="*this"
          >
            {{item}}
          </text>
        </view>
      </view>

      <!-- é›†åˆå®‰å…¨è§„åˆ™åˆ—è¡¨ -->
      <view class="security-collections">
        <text class="collections-title">é›†åˆå®‰å…¨è§„åˆ™</text>
        <view class="collections-grid">
          <view
            class="security-item"
            wx:for="{{dbStatus}}"
            wx:key="index"
            data-collection="{{index}}"
            bindtap="viewSecurityRules"
          >
            <view class="security-collection">{{index}}</view>
            <view class="security-status">
              <text class="security-icon">ğŸ”’</text>
              <text class="security-text">å·²é…ç½®</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ¨¡å‹æ¥å£æ ‡ç­¾é¡µ -->
  <view wx:if="{{activeTab === 'models'}}" class="tab-content">
    <view class="models-section">
      <view class="section-header">
        <text class="section-title">æ¨¡å‹æ¥å£</text>
        <view class="status-actions">
          <text class="action-btn" bindtap="testModelInterface">æµ‹è¯•æ¥å£</text>
        </view>
      </view>

      <!-- æ”¯æŒçš„æ¨¡å‹ç±»å‹ -->
      <view class="models-grid">
        <view
          class="model-item"
          wx:for="{{modelTypes}}"
          wx:key="*this"
          data-type="{{item}}"
          bindtap="createDefaultModel"
        >
          <view class="model-type">{{item}}</view>
          <view class="model-description">
            {{item === 'user' ? 'ç”¨æˆ·æ¨¡å‹' :
              item === 'character' ? 'è§’è‰²æ¨¡å‹' :
              item === 'task' ? 'ä»»åŠ¡æ¨¡å‹' :
              item === 'habit' ? 'ä¹ æƒ¯æ¨¡å‹' :
              item === 'item' ? 'ç‰©å“æ¨¡å‹' :
              item === 'inventory' ? 'åº“å­˜æ¨¡å‹' : 'æœªçŸ¥æ¨¡å‹'}}
          </view>
          <view class="model-action">
            <text class="model-btn">æŸ¥çœ‹é»˜è®¤</text>
          </view>
        </view>
      </view>

      <!-- æ¨¡å‹æ¥å£è¯´æ˜ -->
      <view class="models-info">
        <text class="info-title">æ¨¡å‹æ¥å£åŠŸèƒ½</text>
        <view class="info-list">
          <text class="info-item">â€¢ æ•°æ®æ¨¡å‹åˆ›å»ºå’ŒéªŒè¯</text>
          <text class="info-item">â€¢ ä¸šåŠ¡è§„åˆ™æ£€æŸ¥</text>
          <text class="info-item">â€¢ æ•°æ®åº“æ ¼å¼è½¬æ¢</text>
          <text class="info-item">â€¢ ç»Ÿä¸€çš„CRUDæ“ä½œ</text>
          <text class="info-item">â€¢ æ‰¹é‡æ“ä½œæ”¯æŒ</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæ—¥å¿—æ ‡ç­¾é¡µ -->
  <view wx:if="{{activeTab === 'logs'}}" class="tab-content">
    <view class="logs-section">
      <view class="section-header">
        <text class="section-title">æ“ä½œæ—¥å¿—</text>
        <text class="action-btn" bindtap="clearLogs">æ¸…ç©º</text>
      </view>

      <view class="logs-container">
        <view
          class="log-item log-{{item.type}}"
          wx:for="{{logs}}"
          wx:key="id"
        >
          <text class="log-time">{{item.timestamp}}</text>
          <text class="log-message">{{item.message}}</text>
        </view>

        <view wx:if="{{logs.length === 0}}" class="empty-logs">
          æš‚æ— æ—¥å¿—è®°å½•
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½é®ç½© -->
  <view wx:if="{{loading}}" class="loading-overlay">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">å¤„ç†ä¸­...</text>
    </view>
  </view>
</view>
