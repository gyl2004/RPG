<!--è§’è‰²å¤–è§‚å®šåˆ¶é¡µé¢-->
<view class="appearance-container">
  <!-- è§’è‰²é¢„è§ˆåŒºåŸŸ -->
  <view class="character-preview">
    <view class="preview-card">
      <!-- è§’è‰²å¤´åƒ -->
      <view class="character-avatar-preview">
        <image 
          src="{{character.appearance.avatar || character.avatarUrl}}" 
          class="avatar-image"
          mode="aspectFill"
          wx:if="{{character.appearance.avatar || character.avatarUrl}}"
        />
        <view class="default-avatar" wx:else>
          <text class="avatar-icon">âš”ï¸</text>
        </view>
        

      </view>
      
      <!-- è§’è‰²ä¿¡æ¯ -->
      <view class="character-info-preview">
        <text class="character-name">{{character.name}}</text>
        <text 
          class="character-title" 
          style="color: {{titles[currentAppearance.title].color}}"
        >
          {{titles[currentAppearance.title].name}}
        </text>
        <text class="character-level">Lv.{{character.level}}</text>
      </view>
      
      <!-- é‡‘å¸æ˜¾ç¤º -->
      <view class="coins-display">
        <text class="coins-icon">ğŸ’°</text>
        <text class="coins-amount">{{character.coins || 0}}</text>
        <rpg-button 
          type="accent" 
          text="è·å¾—é‡‘å¸" 
          size="small"
          bindtap="gainCoins"
        />
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»é€‰æ‹© -->
  <view class="category-tabs">
    <scroll-view scroll-x="true" class="tabs-scroll">
      <view class="tabs-container">
        <view 
          class="category-tab {{currentCategory === 'theme' ? 'active' : ''}}" 
          data-category="theme"
          bindtap="switchCategory"
        >
          <text class="tab-icon">ğŸ¨</text>
          <text class="tab-name">ä¸»é¢˜</text>
        </view>

        <view 
          class="category-tab {{currentCategory === 'title' ? 'active' : ''}}" 
          data-category="title"
          bindtap="switchCategory"
        >
          <text class="tab-icon">ğŸ‘‘</text>
          <text class="tab-name">ç§°å·</text>
        </view>
        <view 
          class="category-tab {{currentCategory === 'equipment' ? 'active' : ''}}" 
          data-category="equipment"
          bindtap="switchCategory"
        >
          <text class="tab-icon">âš”ï¸</text>
          <text class="tab-name">è£…å¤‡</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- ç‰©å“åˆ—è¡¨ -->
  <view class="items-section">
    <text class="section-title">{{getCategoryName(currentCategory)}}å•†åº—</text>
    
    <!-- ä¸»é¢˜åˆ—è¡¨ -->
    <view class="items-grid" wx:if="{{currentCategory === 'theme'}}">
      <view
        class="item-card theme-item {{getItemStatusClass(item)}}"
        wx:for="{{themesArray}}"
        wx:key="id"
        wx:for-item="item"
        data-item="{{item.id}}"
        bindtap="showItemDetail"
        style="border-color: {{item.primaryColor}}"
      >
        <view class="item-preview" style="background: {{item.backgroundColor}}">
          <view class="theme-preview-content">
            <view class="preview-bar" style="background: {{item.primaryColor}}"></view>
            <view class="preview-accent" style="background: {{item.accentColor}}"></view>
          </view>
        </view>
        <view class="item-info">
          <text class="item-name">{{item.name}}</text>
          <text class="item-price" wx:if="{{item.price > 0}}">ğŸ’°{{item.price}}</text>
          <text class="item-free" wx:else>å…è´¹</text>
        </view>
        <view class="item-status">
          <text class="status-icon" wx:if="{{currentAppearance.theme === item.id}}">âœ…</text>
          <text class="status-icon" wx:elif="{{item.price === 0}}">ğŸ†“</text>
          <text class="status-icon" wx:else>ğŸ”’</text>
        </view>
      </view>
    </view>



    <!-- ç§°å·åˆ—è¡¨ -->
    <view class="items-list" wx:if="{{currentCategory === 'title'}}">
      <view
        class="item-card title-item {{getItemStatusClass(item)}}"
        wx:for="{{titlesArray}}"
        wx:key="id"
        wx:for-item="item"
        data-item="{{item.id}}"
        bindtap="showItemDetail"
      >
        <view class="title-preview">
          <text class="title-text" style="color: {{item.color}}">{{item.name}}</text>
        </view>
        <view class="item-info">
          <text class="item-description">{{item.description}}</text>
          <text class="unlock-condition">è§£é”æ¡ä»¶: Lv.{{item.unlockLevel}}</text>
        </view>
        <view class="item-status">
          <text class="status-icon" wx:if="{{currentAppearance.title === item.id}}">âœ…</text>
          <text class="status-icon" wx:else>ğŸ”’</text>
        </view>
      </view>
    </view>

    <!-- è£…å¤‡åˆ—è¡¨ -->
    <view class="items-grid" wx:if="{{currentCategory === 'equipment'}}">
      <view
        class="item-card equipment-item {{getItemStatusClass(item)}}"
        wx:for="{{equipmentSkinsArray}}"
        wx:key="id"
        wx:for-item="item"
        data-item="{{item.id}}"
        bindtap="showItemDetail"
      >
        <view class="item-preview">
          <image 
            src="{{item.image}}"
            class="equipment-image"
            mode="aspectFit"
          />
        </view>
        <view class="item-info">
          <text class="item-name">{{item.name}}</text>
          <text class="item-category">{{item.category === 'weapon' ? 'æ­¦å™¨' : 'æŠ¤ç”²'}}</text>
          <text class="item-price" wx:if="{{item.price > 0}}">ğŸ’°{{item.price}}</text>
          <text class="item-free" wx:else>å…è´¹</text>
        </view>
        <view class="item-status">
          <text class="status-icon" wx:if="{{currentAppearance.equipment[item.category] === item.id}}">âœ…</text>
          <text class="status-icon" wx:elif="{{item.price === 0}}">ğŸ†“</text>
          <text class="status-icon" wx:else>ğŸ”’</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç‰©å“è¯¦æƒ…æ¨¡æ€æ¡† -->
  <view class="modal-overlay" wx:if="{{showItemModal}}" bindtap="closeItemModal">
    <view class="item-modal" catchtap="">
      <view class="modal-header">
        <text class="modal-title">{{selectedItem.name}}</text>
        <view class="modal-price" wx:if="{{selectedItem.price > 0}}">
          <text class="price-icon">ğŸ’°</text>
          <text class="price-text">{{selectedItem.price}}</text>
        </view>
        <text class="modal-free" wx:else>å…è´¹</text>
      </view>

      <view class="modal-content">
        <!-- ç‰©å“é¢„è§ˆ -->
        <view class="item-preview-large">
          <!-- ä¸»é¢˜é¢„è§ˆ -->
          <view
            class="theme-preview-large"
            wx:if="{{selectedItem.itemType === 'theme'}}"
            style="background: {{selectedItem.backgroundColor}}; border-color: {{selectedItem.primaryColor}}"
          >
            <view class="theme-demo">
              <view class="demo-header" style="background: {{selectedItem.primaryColor}}">
                <text class="demo-title">ä¸»é¢˜é¢„è§ˆ</text>
              </view>
              <view class="demo-content" style="background: {{selectedItem.cardColor}}">
                <view class="demo-accent" style="background: {{selectedItem.accentColor}}"></view>
              </view>
            </view>
          </view>

          <!-- å¤´åƒæ¡†é¢„è§ˆ -->
          <view class="frame-preview-large" wx:if="{{selectedItem.itemType === 'avatarFrame'}}">
            <view class="large-avatar">
              <image
                src="{{character.appearance.avatar || character.avatarUrl}}"
                class="large-avatar-image"
                mode="aspectFill"
                wx:if="{{character.appearance.avatar || character.avatarUrl}}"
              />
              <view class="large-default-avatar" wx:else>
                <text class="large-avatar-icon">âš”ï¸</text>
              </view>
              <image
                src="{{selectedItem.frameImage}}"
                class="large-avatar-frame"
                mode="aspectFill"
                wx:if="{{selectedItem.frameImage}}"
              />
            </view>
          </view>

          <!-- ç§°å·é¢„è§ˆ -->
          <view class="title-preview-large" wx:if="{{selectedItem.itemType === 'title'}}">
            <text class="large-title-text" style="color: {{selectedItem.color}}">
              {{selectedItem.name}}
            </text>
          </view>

          <!-- è£…å¤‡é¢„è§ˆ -->
          <view class="equipment-preview-large" wx:if="{{selectedItem.itemType === 'equipment'}}">
            <image
              src="{{selectedItem.image}}"
              class="large-equipment-image"
              mode="aspectFit"
            />
          </view>
        </view>

        <!-- ç‰©å“æè¿° -->
        <text class="item-description-full">{{selectedItem.description}}</text>

        <!-- è§£é”æ¡ä»¶ -->
        <view class="unlock-info" wx:if="{{!selectedItem.unlocked}}">
          <text class="unlock-title">è§£é”æ¡ä»¶</text>
          <text class="unlock-reason">{{selectedItem.unlockReason}}</text>
        </view>

        <!-- çŠ¶æ€ä¿¡æ¯ -->
        <view class="status-info">
          <text class="status-label">çŠ¶æ€</text>
          <text class="status-text equipped" wx:if="{{selectedItem.isEquipped}}">å·²è£…å¤‡</text>
          <text class="status-text owned" wx:elif="{{selectedItem.isOwned}}">å·²æ‹¥æœ‰</text>
          <text class="status-text available" wx:elif="{{selectedItem.unlocked}}">å¯è´­ä¹°</text>
          <text class="status-text locked" wx:else>æœªè§£é”</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="modal-actions">
        <rpg-button
          type="secondary"
          text="é¢„è§ˆ"
          size="small"
          bindtap="previewItem"
          wx:if="{{selectedItem.unlocked}}"
        />
        <rpg-button
          type="primary"
          text="è´­ä¹°"
          size="small"
          bindtap="purchaseItem"
          wx:if="{{selectedItem.canPurchase}}"
        />
        <rpg-button
          type="accent"
          text="è£…å¤‡"
          size="small"
          bindtap="equipItem"
          wx:if="{{selectedItem.canEquip}}"
        />
        <rpg-button
          type="secondary"
          text="å…³é—­"
          size="small"
          bindtap="closeItemModal"
        />
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-overlay">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>
</view>
