<!--åˆ›å»ºä¹ æƒ¯é¡µé¢-->
<view class="create-habit-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <text class="page-title">åˆ›å»ºä¹ æƒ¯</text>
    <text class="page-subtitle">åŸ¹å…»ä¸€ä¸ªæ–°çš„å¥½ä¹ æƒ¯</text>
  </view>

  <!-- è¡¨å•å†…å®¹ -->
  <view class="form-container">
    <!-- ä¹ æƒ¯åç§° -->
    <view class="form-section">
      <text class="section-label">ä¹ æƒ¯åç§° *</text>
      <input 
        class="form-input"
        placeholder="ä¾‹å¦‚ï¼šæ¯å¤©å–8æ¯æ°´"
        value="{{formData.name}}"
        bindinput="onNameInput"
        maxlength="20"
      />
      <text class="form-hint">ç®€æ´æ˜ç¡®çš„ä¹ æƒ¯æè¿°</text>
    </view>

    <!-- ä¹ æƒ¯æè¿° -->
    <view class="form-section">
      <text class="section-label">ä¹ æƒ¯æè¿°</text>
      <textarea 
        class="form-textarea"
        placeholder="è¯¦ç»†æè¿°è¿™ä¸ªä¹ æƒ¯çš„å†…å®¹å’Œç›®æ ‡..."
        value="{{formData.description}}"
        bindinput="onDescriptionInput"
        maxlength="100"
      />
    </view>

    <!-- ä¹ æƒ¯åˆ†ç±» -->
    <view class="form-section">
      <text class="section-label">ä¹ æƒ¯åˆ†ç±» *</text>
      <view 
        class="form-selector"
        bindtap="showCategoryPicker"
      >
        <text class="selector-text" wx:if="{{categories && categories[formData.category]}}">
          {{categories[formData.category].name}}
        </text>
        <text class="selector-text placeholder" wx:else>é€‰æ‹©åˆ†ç±»</text>
        <text class="selector-icon" wx:if="{{categories && categories[formData.category]}}">
          {{categories[formData.category].icon}}
        </text>
        <text class="selector-icon" wx:else>ğŸ“‹</text>
      </view>
      <text class="form-hint" wx:if="{{categories && categories[formData.category]}}">
        {{categories[formData.category].description}}
      </text>
    </view>

    <!-- ä¹ æƒ¯é¢‘ç‡ -->
    <view class="form-section">
      <text class="section-label">æ‰§è¡Œé¢‘ç‡ *</text>
      <view 
        class="form-selector"
        bindtap="showFrequencyPicker"
      >
        <text class="selector-text" wx:if="{{frequencies && frequencies[formData.frequency]}}">
          {{frequencies[formData.frequency].name}}
        </text>
        <text class="selector-text placeholder" wx:else>é€‰æ‹©é¢‘ç‡</text>
        <text class="selector-icon" wx:if="{{frequencies && frequencies[formData.frequency]}}">
          {{frequencies[formData.frequency].icon}}
        </text>
        <text class="selector-icon" wx:else>ğŸ“…</text>
      </view>
      <text class="form-hint" wx:if="{{frequencies && frequencies[formData.frequency]}}">
        {{frequencies[formData.frequency].description}}
      </text>
    </view>

    <!-- ç›®æ ‡æ¬¡æ•° -->
    <view class="form-section" wx:if="{{formData.frequency === 'weekly' || formData.frequency === 'custom'}}">
      <text class="section-label">ç›®æ ‡æ¬¡æ•°</text>
      <view class="number-input-container">
        <text class="number-label">æ¯å‘¨ç›®æ ‡ï¼š</text>
        <input 
          class="number-input"
          type="number"
          value="{{formData.targetCount}}"
          bindinput="onTargetCountChange"
          min="1"
          max="7"
        />
        <text class="number-unit">æ¬¡</text>
      </view>
    </view>

    <!-- æé†’æ—¶é—´ -->
    <view class="form-section">
      <text class="section-label">æé†’æ—¶é—´</text>
      <picker 
        mode="time"
        value="{{formData.reminderTime}}"
        bindchange="onReminderTimeChange"
      >
        <view class="form-selector">
          <text class="selector-text" wx:if="{{formData.reminderTime}}">
            {{formData.reminderTime}}
          </text>
          <text class="selector-text placeholder" wx:else>è®¾ç½®æé†’æ—¶é—´</text>
          <text class="selector-icon">â°</text>
        </view>
      </picker>
      <text class="form-hint">å¯é€‰ï¼Œè®¾ç½®åä¼šåœ¨æŒ‡å®šæ—¶é—´æé†’ä½ </text>
    </view>

    <!-- å¤‡æ³¨ -->
    <view class="form-section">
      <text class="section-label">å¤‡æ³¨</text>
      <textarea 
        class="form-textarea"
        placeholder="è®°å½•ä¸€äº›å…³äºè¿™ä¸ªä¹ æƒ¯çš„æƒ³æ³•æˆ–è®¡åˆ’..."
        value="{{formData.notes}}"
        bindinput="onNotesInput"
        maxlength="200"
      />
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <rpg-button 
      type="secondary" 
      text="é‡ç½®" 
      bindtap="resetForm"
    />
    <rpg-button
      type="primary"
      text="{{loading ? 'åˆ›å»ºä¸­...' : 'åˆ›å»ºä¹ æƒ¯'}}"
      disabled="{{loading || creating}}"
      bindtap="createHabit"
    />
  </view>

  <!-- åˆ†ç±»é€‰æ‹©å™¨ -->
  <view class="picker-overlay" wx:if="{{showCategoryPicker}}" bindtap="closePicker">
    <view class="picker-modal" catchtap="">
      <view class="picker-header">
        <text class="picker-title">é€‰æ‹©ä¹ æƒ¯åˆ†ç±»</text>
      </view>
      
      <view class="picker-content">
        <view 
          class="picker-item"
          wx:for="{{categoriesArray}}"
          wx:key="id"
          data-category="{{item.id}}"
          bindtap="selectCategory"
        >
          <text class="picker-icon">{{item.icon}}</text>
          <view class="picker-info">
            <text class="picker-name">{{item.name}}</text>
            <text class="picker-desc">{{item.description}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- é¢‘ç‡é€‰æ‹©å™¨ -->
  <view class="picker-overlay" wx:if="{{showFrequencyPicker}}" bindtap="closePicker">
    <view class="picker-modal" catchtap="">
      <view class="picker-header">
        <text class="picker-title">é€‰æ‹©æ‰§è¡Œé¢‘ç‡</text>
      </view>
      
      <view class="picker-content">
        <view 
          class="picker-item"
          wx:for="{{frequenciesArray}}"
          wx:key="id"
          data-frequency="{{item.id}}"
          bindtap="selectFrequency"
        >
          <text class="picker-icon">{{item.icon}}</text>
          <view class="picker-info">
            <text class="picker-name">{{item.name}}</text>
            <text class="picker-desc">{{item.description}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
