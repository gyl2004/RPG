<!--ä¸ªäººèµ„æ–™é¡µé¢-->
<view class="profile-container">
  <!-- ç”¨æˆ·å¤´åƒå’ŒåŸºæœ¬ä¿¡æ¯ -->
  <view class="profile-header">
    <view class="header-background"></view>
    <view class="avatar-section">
      <view class="avatar-container">
        <image
          src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}"
          class="user-avatar"
          mode="aspectFill"
        />
        <view class="avatar-frame {{character.characterType || 'explorer'}}"></view>
        <view class="level-badge">
          <text class="level-number">{{character.level || 1}}</text>
        </view>
      </view>
      <view class="online-status">
        <view class="status-dot"></view>
        <text class="status-text">åœ¨çº¿</text>
      </view>
    </view>

    <view class="user-basic-info">
      <view class="name-section">
        <text class="user-name">{{userInfo.nickname || 'å†’é™©è€…'}}</text>
        <view class="character-type-badge {{character.characterType || 'explorer'}}">
          <text class="character-icon">{{characterTypeInfo.icon}}</text>
          <text class="character-name">{{characterTypeInfo.name}}</text>
        </view>
      </view>

      <text class="user-title">{{characterTitle || 'æ–°æ‰‹å†’é™©è€…'}}</text>

      <view class="level-section">
        <view class="level-info">
          <text class="level-text">ç­‰çº§ {{character.level || 1}}</text>
          <text class="exp-text">{{character.currentExp || 0}} / {{character.nextLevelExp || 100}} EXP</text>
        </view>
        <view class="exp-bar">
          <view class="exp-progress" style="width: {{expPercent}}%"></view>
          <view class="exp-glow" style="width: {{expPercent}}%"></view>
        </view>
      </view>

      <view class="resources-section">
        <view class="resource-item">
          <text class="resource-icon">ğŸ’°</text>
          <text class="resource-value">{{character.coins || 0}}</text>
          <text class="resource-label">é‡‘å¸</text>
        </view>
        <view class="resource-item">
          <text class="resource-icon">â­</text>
          <text class="resource-value">{{character.totalExp || 0}}</text>
          <text class="resource-label">æ€»ç»éªŒ</text>
        </view>
        <view class="resource-item">
          <text class="resource-icon">ğŸ†</text>
          <text class="resource-value">{{statistics.achievementsUnlocked || 0}}</text>
          <text class="resource-label">æˆå°±</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è§’è‰²å±æ€§ -->
  <view class="attributes-section">
    <view class="section-header">
      <text class="section-title">è§’è‰²å±æ€§</text>
      <rpg-button
        type="tertiary"
        text="åˆ†é…ç‚¹æ•°"
        size="small"
        bindtap="allocateAttributes"
        wx:if="{{character.availableAttributePoints > 0}}"
      />
    </view>
    <view class="attributes-grid">
      <view
        class="attribute-item"
        wx:for="{{attributesList}}"
        wx:key="id"
        data-attribute="{{item.id}}"
        bindtap="viewAttributeDetail"
      >
        <view class="attribute-header">
          <text class="attribute-icon">{{item.icon}}</text>
          <text class="attribute-name">{{item.name}}</text>
          <text class="attribute-value">{{item.value}}</text>
        </view>
        <view class="attribute-bar">
          <view class="attribute-progress" style="width: {{item.percent}}%; background-color: {{item.color}}"></view>
        </view>
        <text class="attribute-description">{{item.description}}</text>
      </view>
    </view>
    <view wx:if="{{character.availableAttributePoints > 0}}" class="available-points">
      <text class="points-text">å¯åˆ†é…ç‚¹æ•°: {{character.availableAttributePoints}}</text>
    </view>
  </view>

  <!-- ç»Ÿè®¡æ•°æ® -->
  <view class="stats-section">
    <text class="section-title">æˆé•¿è®°å½•</text>
    <view class="stats-grid">
      <view class="stat-item" bindtap="viewStatistics">
        <view class="stat-icon">ğŸ“‹</view>
        <text class="stat-number">{{statistics.tasksCompleted || 0}}</text>
        <text class="stat-label">ä»»åŠ¡å®Œæˆ</text>
      </view>
      <view class="stat-item" bindtap="viewStatistics">
        <view class="stat-icon">ğŸ”„</view>
        <text class="stat-number">{{statistics.habitsFormed || 0}}</text>
        <text class="stat-label">ä¹ æƒ¯å…»æˆ</text>
      </view>
      <view class="stat-item" bindtap="viewStatistics">
        <view class="stat-icon">ğŸ†</view>
        <text class="stat-number">{{statistics.achievementsUnlocked || 0}}</text>
        <text class="stat-label">æˆå°±è§£é”</text>
      </view>
      <view class="stat-item" bindtap="viewStatistics">
        <view class="stat-icon">ğŸ“…</view>
        <text class="stat-number">{{statistics.loginDays || 0}}</text>
        <text class="stat-label">ç™»å½•å¤©æ•°</text>
      </view>
      <view class="stat-item" bindtap="viewStatistics">
        <view class="stat-icon">âš¡</view>
        <text class="stat-number">{{statistics.maxStreak || 0}}</text>
        <text class="stat-label">æœ€é•¿è¿å‡»</text>
      </view>
      <view class="stat-item" bindtap="viewStatistics">
        <view class="stat-icon">ğŸ¯</view>
        <text class="stat-number">{{statistics.perfectDays || 0}}</text>
        <text class="stat-label">å®Œç¾å¤©æ•°</text>
      </view>
      <view class="stat-item" bindtap="goToItemCollection">
        <view class="stat-icon">ğŸ’</view>
        <text class="stat-number">{{character.collectedItems.length || 0}}</text>
        <text class="stat-label">æ”¶è—ç‰©å“</text>
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘æ´»åŠ¨ -->
  <view class="recent-activity-section">
    <text class="section-title">æœ€è¿‘æ´»åŠ¨</text>
    <view class="activity-list">
      <view
        class="activity-item"
        wx:for="{{recentActivities}}"
        wx:key="id"
      >
        <view class="activity-icon">{{item.icon}}</view>
        <view class="activity-content">
          <text class="activity-title">{{item.title}}</text>
          <text class="activity-description">{{item.description}}</text>
          <text class="activity-time">{{item.timeAgo}}</text>
        </view>
        <view class="activity-reward" wx:if="{{item.reward}}">
          <text class="reward-text">+{{item.reward}}</text>
        </view>
      </view>
    </view>
    <view wx:if="{{recentActivities.length === 0}}" class="empty-activity">
      <text class="empty-text">æš‚æ— æœ€è¿‘æ´»åŠ¨</text>
    </view>
  </view>

  <!-- å¿«é€Ÿæ“ä½œ -->
  <view class="actions-section">
    <text class="section-title">å¿«é€Ÿæ“ä½œ</text>
    <view class="action-grid">
      <view class="action-item" bindtap="goToCharacter">
        <view class="action-icon">ğŸ‘¤</view>
        <text class="action-text">è§’è‰²è¯¦æƒ…</text>
      </view>
      <view class="action-item" bindtap="viewAchievements">
        <view class="action-icon">ğŸ†</view>
        <text class="action-text">æˆå°±ç³»ç»Ÿ</text>
      </view>
      <view class="action-item" bindtap="goToSkills">
        <view class="action-icon">âš¡</view>
        <text class="action-text">æŠ€èƒ½æ ‘</text>
      </view>
      <view class="action-item" bindtap="goToAppearance">
        <view class="action-icon">ğŸ¨</view>
        <text class="action-text">å¤–è§‚å®šåˆ¶</text>
      </view>
      <view class="action-item" bindtap="viewStatistics">
        <view class="action-icon">ğŸ“Š</view>
        <text class="action-text">æ•°æ®ç»Ÿè®¡</text>
      </view>
      <view class="action-item" bindtap="goToSettings">
        <view class="action-icon">âš™ï¸</view>
        <text class="action-text">è®¾ç½®</text>
      </view>
    </view>
  </view>

  <!-- ä¸ªäººä¿¡æ¯ -->
  <view class="info-section">
    <text class="section-title">è´¦æˆ·ä¿¡æ¯</text>
    <view class="info-list">
      <view class="info-item">
        <view class="info-icon">ğŸ†”</view>
        <text class="info-label">ç”¨æˆ·ID</text>
        <text class="info-value">{{userInfo._id ? userInfo._id.slice(-8) : 'Unknown'}}</text>
      </view>
      <view class="info-item">
        <view class="info-icon">ğŸ“…</view>
        <text class="info-label">æ³¨å†Œæ—¶é—´</text>
        <text class="info-value">{{userInfo.registrationDate ? userInfo.registrationDate.slice(0, 10) : 'æœªçŸ¥'}}</text>
      </view>
      <view class="info-item">
        <view class="info-icon">ğŸ•</view>
        <text class="info-label">æœ€åç™»å½•</text>
        <text class="info-value">{{userInfo.lastLoginDate ? userInfo.lastLoginDate.slice(0, 10) : 'æœªçŸ¥'}}</text>
      </view>
      <view class="info-item">
        <view class="info-icon">â­</view>
        <text class="info-label">æ€»ç»éªŒå€¼</text>
        <text class="info-value">{{statistics.experienceGained || 0}}</text>
      </view>
      <view class="info-item">
        <view class="info-icon">ğŸ¯</view>
        <text class="info-label">è§’è‰²ç±»å‹</text>
        <text class="info-value">{{characterTypeInfo.name || 'æ¢é™©å®¶'}}</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-overlay">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>
</view>
