<!--ä¹ æƒ¯è¯¦æƒ…é¡µé¢-->
<view class="habit-detail-container" wx:if="{{habit}}">
  <!-- ä¹ æƒ¯åŸºæœ¬ä¿¡æ¯ -->
  <view class="habit-info-section">
    <view class="habit-header">
      <text class="habit-name">{{habit.name}}</text>
      <view class="habit-status {{habit.status}}" wx:if="{{statuses && statuses[habit.status]}}">
        <text class="status-icon">{{statuses[habit.status].icon}}</text>
        <text class="status-text">{{statuses[habit.status].name}}</text>
      </view>
    </view>
    
    <text class="habit-description" wx:if="{{habit.description}}">{{habit.description}}</text>
    
    <view class="habit-meta">
      <view class="meta-item" wx:if="{{categories && categories[habit.category]}}">
        <text class="meta-icon">{{categories[habit.category].icon}}</text>
        <text class="meta-text">{{categories[habit.category].name}}</text>
      </view>
      <view class="meta-item">
        <text class="meta-icon">ğŸ“…</text>
        <text class="meta-text">åˆ›å»ºäº {{formatDate(habit.createdAt)}}</text>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="stats-section">
    <text class="section-title">ç»Ÿè®¡ä¿¡æ¯</text>
    <view class="stats-grid">
      <view class="stat-card">
        <text class="stat-number">{{habit.currentStreak}}</text>
        <text class="stat-label">å½“å‰è¿ç»­</text>
        <text class="stat-unit">å¤©</text>
      </view>
      <view class="stat-card">
        <text class="stat-number">{{habit.longestStreak}}</text>
        <text class="stat-label">æœ€é•¿è¿ç»­</text>
        <text class="stat-unit">å¤©</text>
      </view>
      <view class="stat-card">
        <text class="stat-number">{{habit.totalCompletions}}</text>
        <text class="stat-label">æ€»å®Œæˆ</text>
        <text class="stat-unit">æ¬¡</text>
      </view>
      <view class="stat-card">
        <text class="stat-number">{{habit.weeklyCheckIns || 0}}</text>
        <text class="stat-label">æœ¬å‘¨å®Œæˆ</text>
        <text class="stat-unit">æ¬¡</text>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥æ‰“å¡ -->
  <view class="checkin-section" wx:if="{{habit.status === 'active'}}">
    <text class="section-title">ä»Šæ—¥æ‰“å¡</text>
    <view class="checkin-card">
      <view class="checkin-info">
        <text class="checkin-date">ä»Šæ—¥</text>
        <text class="checkin-status {{habit.todayChecked ? 'checked' : 'unchecked'}}">
          {{habit.todayChecked ? 'å·²å®Œæˆ' : 'å¾…å®Œæˆ'}}
        </text>
      </view>
      <rpg-button
        wx:if="{{!habit.todayChecked}}"
        type="accent"
        text="æ‰“å¡"
        size="small"
        bindtap="checkInHabit"
      />
      <view wx:else class="checked-badge">
        <text class="checked-icon">âœ…</text>
        <text class="checked-text">å·²æ‰“å¡</text>
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘æ‰“å¡è®°å½• -->
  <view class="records-section" wx:if="{{habit.checkIns && habit.checkIns.length > 0}}">
    <text class="section-title">æœ€è¿‘è®°å½•</text>
    <view class="records-list">
      <view 
        class="record-item"
        wx:for="{{habit.checkIns.slice(0, 10)}}"
        wx:key="id"
        wx:for-item="record"
      >
        <view class="record-date">
          <text class="date-text">{{record.date}}</text>
          <text class="time-text">{{record.timestamp ? record.timestamp.substring(11, 19) : ''}}</text>
        </view>
        <view class="record-info">
          <text class="record-count">å®Œæˆ {{record.count}} æ¬¡</text>
          <text class="record-notes" wx:if="{{record.notes}}">{{record.notes}}</text>
        </view>
        <text class="record-icon">âœ…</text>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <rpg-button 
      wx:if="{{habit.status === 'active'}}"
      type="secondary" 
      text="æš‚åœä¹ æƒ¯" 
      bindtap="toggleHabitStatus"
    />
    <rpg-button 
      wx:if="{{habit.status === 'paused'}}"
      type="primary" 
      text="æ¢å¤ä¹ æƒ¯" 
      bindtap="toggleHabitStatus"
    />
    <rpg-button 
      type="danger" 
      text="åˆ é™¤ä¹ æƒ¯" 
      bindtap="showDeleteConfirm"
    />
  </view>

  <!-- åˆ é™¤ç¡®è®¤æ¨¡æ€æ¡† -->
  <view class="modal-overlay" wx:if="{{showDeleteModal}}" bindtap="hideDeleteConfirm">
    <view class="delete-modal" catchtap="">
      <view class="modal-header">
        <text class="modal-title">åˆ é™¤ä¹ æƒ¯</text>
      </view>
      <view class="modal-content">
        <text class="modal-text">ç¡®å®šè¦åˆ é™¤ä¹ æƒ¯"{{habit.name}}"å—ï¼Ÿ</text>
        <text class="modal-warning">åˆ é™¤åå°†æ— æ³•æ¢å¤æ‰€æœ‰æ‰“å¡è®°å½•ã€‚</text>
      </view>
      <view class="modal-actions">
        <rpg-button 
          type="secondary" 
          text="å–æ¶ˆ" 
          bindtap="hideDeleteConfirm"
        />
        <rpg-button 
          type="danger" 
          text="åˆ é™¤" 
          bindtap="deleteHabit"
        />
      </view>
    </view>
  </view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-state" wx:if="{{loading}}">
  <view class="loading-spinner"></view>
  <text class="loading-text">åŠ è½½ä¸­...</text>
</view>
