<!--ä¹ æƒ¯ä¸­å¿ƒé¡µé¢-->
<view class="habits-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="habits-header">
    <text class="page-title">ä¹ æƒ¯å…»æˆ</text>
    <view class="header-actions" wx:if="{{habits.length > 0}}">
      <rpg-button
        type="primary"
        text="æ–°å»ºä¹ æƒ¯"
        size="small"
        bindtap="createHabit"
      />
    </view>
  </view>

  <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
  <view class="statistics-section" wx:if="{{statistics.total > 0}}">
    <text class="section-title">ä»Šæ—¥æ¦‚è§ˆ</text>
    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-number">{{statistics.active}}</text>
        <text class="stat-label">è¿›è¡Œä¸­</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{statistics.totalCheckIns}}</text>
        <text class="stat-label">æ€»æ‰“å¡</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{statistics.averageStreak}}</text>
        <text class="stat-label">å¹³å‡è¿ç»­</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{statistics.total}}</text>
        <text class="stat-label">æ€»ä¹ æƒ¯</text>
      </view>
    </view>
  </view>

  <!-- è¿‡æ»¤å™¨ -->
  <view class="filter-section" wx:if="{{habits.length > 0}}">
    <scroll-view class="filter-scroll" scroll-x="true">
      <view class="filter-list">
        <view
          class="filter-item {{currentFilter === item.id ? 'active' : ''}}"
          wx:for="{{filters}}"
          wx:key="id"
          data-filter="{{item.id}}"
          bindtap="filterHabits"
        >
          <text class="filter-icon">{{item.icon}}</text>
          <text class="filter-text">{{item.name}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- ä¹ æƒ¯åˆ—è¡¨ -->
  <view class="habits-list" wx:if="{{habits.length > 0}}">
    <view
      class="habit-card"
      wx:for="{{habits}}"
      wx:key="id"
      wx:for-item="habit"
    >
      <!-- ä¹ æƒ¯å¤´éƒ¨ -->
      <view class="habit-header">
        <view class="habit-info" bindtap="viewHabitDetail" data-habit-id="{{habit.id}}">
          <view class="habit-title-row">
            <text class="habit-name">{{habit.name}}</text>
            <view class="habit-status {{habit.status}}" wx:if="{{statuses && statuses[habit.status]}}">
              <text class="status-icon">{{statuses[habit.status].icon}}</text>
            </view>
          </view>
          <text class="habit-description" wx:if="{{habit.description}}">{{habit.description}}</text>
          <view class="habit-meta">
            <view class="meta-item" wx:if="{{categories && categories[habit.category]}}">
              <text class="meta-icon">{{categories[habit.category].icon}}</text>
              <text class="meta-text">{{categories[habit.category].name}}</text>
            </view>
            <view class="meta-item">
              <text class="meta-icon">ğŸ”¥</text>
              <text class="meta-text">{{habit.currentStreak}}å¤©è¿ç»­</text>
            </view>
          </view>
        </view>

        <!-- ä¹ æƒ¯æ“ä½œæŒ‰é’® -->
        <view class="habit-actions">
          <view
            class="action-btn pause-btn"
            wx:if="{{habit.status === 'active'}}"
            data-habit-id="{{habit.id}}"
            data-status="{{habit.status}}"
            bindtap="toggleHabitStatus"
          >
            <text class="action-icon">â¸ï¸</text>
          </view>
          <view
            class="action-btn resume-btn"
            wx:if="{{habit.status === 'paused'}}"
            data-habit-id="{{habit.id}}"
            data-status="{{habit.status}}"
            bindtap="toggleHabitStatus"
          >
            <text class="action-icon">â–¶ï¸</text>
          </view>
          <view
            class="action-btn delete-btn"
            data-habit-id="{{habit.id}}"
            data-habit-name="{{habit.name}}"
            bindtap="deleteHabit"
          >
            <text class="action-icon">ğŸ—‘ï¸</text>
          </view>
        </view>
      </view>

      <!-- æ‰“å¡åŒºåŸŸ -->
      <view class="habit-checkin" wx:if="{{habit.status === 'active'}}">
        <view class="checkin-info">
          <text class="checkin-date">ä»Šæ—¥</text>
          <text class="checkin-status checked" wx:if="{{habit.todayChecked}}">å·²å®Œæˆ</text>
          <text class="checkin-status unchecked" wx:else>å¾…å®Œæˆ</text>
        </view>
        <view class="checkin-action">
          <rpg-button
            wx:if="{{!habit.todayChecked}}"
            type="accent"
            text="æ‰“å¡"
            size="small"
            data-habit-id="{{habit.id}}"
            bindtap="checkInHabit"
          />
          <view wx:else class="checked-badge">
            <text class="checked-icon">âœ…</text>
            <text class="checked-text">å·²æ‰“å¡</text>
          </view>
        </view>
      </view>

      <!-- è¿›åº¦æ¡ -->
      <view class="habit-progress" wx:if="{{habit.status === 'active'}}">
        <view class="progress-info">
          <text class="progress-label">æœ¬å‘¨è¿›åº¦</text>
          <text class="progress-text">{{habit.weeklyProgress || 0}}/7</text>
        </view>
        <view class="progress-bar">
          <view
            class="progress-fill"
            style="width: {{Math.min(100, ((habit.weeklyProgress || 0) / 7) * 100)}}%"
          ></view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{habits.length === 0 && !loading}}">
    <text class="empty-icon">ğŸŒ±</text>
    <text class="empty-title">è¿˜æ²¡æœ‰ä¹ æƒ¯</text>
    <text class="empty-desc">å¼€å§‹åŸ¹å…»ç¬¬ä¸€ä¸ªå¥½ä¹ æƒ¯å§ï¼</text>
    <rpg-button
      type="primary"
      text="åˆ›å»ºä¹ æƒ¯"
      bindtap="createHabit"
    />
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>
