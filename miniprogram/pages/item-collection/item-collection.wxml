<!--ç‰©å“æ”¶è—è®°å½•é¡µé¢-->
<view class="collection-container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">ğŸ’ æˆ‘çš„æ”¶è—</text>
    <text class="page-subtitle">è®°å½•ä½ çš„çè´µç‰©å“ï¼Œæ¢ç´¢å®ƒä»¬çš„é­”å¹»æ•…äº‹</text>
  </view>

  <!-- æ·»åŠ ç‰©å“æŒ‰é’® -->
  <view class="add-item-section">
    <rpg-button
      type="primary"
      text="+ è®°å½•æ–°ç‰©å“"
      size="medium"
      bindtap="showAddItemModal"
    />
  </view>

  <!-- ç‰©å“åˆ—è¡¨ -->
  <view class="items-list" wx:if="{{collectedItems.length > 0}}">
    <view
      class="item-card"
      wx:for="{{collectedItems}}"
      wx:key="id"
      data-item="{{item}}"
      bindtap="showItemDetail"
    >
      <view class="item-header">
        <view class="item-icon">{{item.icon || 'ğŸ“¦'}}</view>
        <view class="item-info">
          <text class="item-name">{{item.name}}</text>
          <text class="item-category">{{item.category}}</text>
          <text class="item-date">{{item.purchaseDate}}</text>
        </view>
        <view class="item-actions">
          <view class="ai-status {{item.aiDescription ? 'has-description' : 'no-description'}}">
            <text class="status-icon">{{item.aiDescription ? 'âœ¨' : 'ğŸ¤–'}}</text>
          </view>
        </view>
      </view>
      
      <view class="item-description" wx:if="{{item.description}}">
        <text class="description-text">{{item.description}}</text>
      </view>
      
      <view class="item-ai-preview" wx:if="{{item.aiDescription}}">
        <text class="ai-label">âœ¨ AIé­”å¹»æè¿°</text>
        <text class="ai-preview">{{item.aiDescription.substring(0, 50)}}...</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:else>
    <view class="empty-icon">ğŸ“¦</view>
    <text class="empty-title">è¿˜æ²¡æœ‰æ”¶è—ä»»ä½•ç‰©å“</text>
    <text class="empty-subtitle">å¼€å§‹è®°å½•ä½ çš„ç¬¬ä¸€ä¸ªçè´µç‰©å“å§ï¼</text>
  </view>

  <!-- æ·»åŠ ç‰©å“æ¨¡æ€æ¡† -->
  <view class="modal-overlay" wx:if="{{showAddModal}}" bindtap="closeAddModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">è®°å½•æ–°ç‰©å“</text>
        <view class="modal-close" bindtap="closeAddModal">Ã—</view>
      </view>
      
      <view class="modal-body">
        <view class="form-group">
          <text class="form-label">ç‰©å“åç§°</text>
          <input
            class="form-input"
            placeholder="è¾“å…¥ç‰©å“åç§°"
            value="{{newItem.name}}"
            bindinput="onNameInput"
          />
        </view>
        
        <view class="form-group">
          <text class="form-label">ç‰©å“åˆ†ç±»</text>
          <picker
            class="form-picker"
            range="{{categories}}"
            value="{{newItem.categoryIndex}}"
            bindchange="onCategoryChange"
          >
            <view class="picker-display">
              {{categories[newItem.categoryIndex] || 'é€‰æ‹©åˆ†ç±»'}}
            </view>
          </picker>
        </view>
        
        <view class="form-group">
          <text class="form-label">ç‰©å“å›¾æ ‡</text>
          <view class="icon-selector">
            <view
              class="icon-option {{newItem.icon === icon ? 'selected' : ''}}"
              wx:for="{{iconOptions}}"
              wx:for-item="icon"
              wx:key="*this"
              data-icon="{{icon}}"
              bindtap="selectIcon"
            >
              {{icon}}
            </view>
          </view>
        </view>
        
        <view class="form-group">
          <text class="form-label">è´­ä¹°ä»·æ ¼</text>
          <input
            class="form-input"
            type="number"
            placeholder="è¾“å…¥ä»·æ ¼ï¼ˆå¯é€‰ï¼‰"
            value="{{newItem.price}}"
            bindinput="onPriceInput"
          />
        </view>
        
        <view class="form-group">
          <text class="form-label">ç‰©å“æè¿°</text>
          <textarea
            class="form-textarea"
            placeholder="æè¿°è¿™ä¸ªç‰©å“çš„ç‰¹ç‚¹ã€ç”¨é€”æˆ–æ•…äº‹..."
            value="{{newItem.description}}"
            bindinput="onDescriptionInput"
            maxlength="200"
          />
          <text class="char-count">{{newItem.description.length}}/200</text>
        </view>
      </view>
      
      <view class="modal-actions">
        <rpg-button
          type="secondary"
          text="å–æ¶ˆ"
          size="small"
          bindtap="closeAddModal"
        />
        <rpg-button
          type="primary"
          text="{{saving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜'}}"
          size="small"
          bindtap="saveNewItem"
          disabled="{{!newItem.name || saving}}"
          loading="{{saving}}"
        />
      </view>
    </view>
  </view>

  <!-- ç‰©å“è¯¦æƒ…æ¨¡æ€æ¡† -->
  <view class="modal-overlay" wx:if="{{showDetailModal}}" bindtap="closeDetailModal">
    <view class="modal-content detail-modal" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">{{selectedItem.name}}</text>
        <view class="modal-close" bindtap="closeDetailModal">Ã—</view>
      </view>
      
      <view class="modal-body">
        <view class="item-detail-header">
          <view class="detail-icon">{{selectedItem.icon}}</view>
          <view class="detail-info">
            <text class="detail-category">{{selectedItem.category}}</text>
            <text class="detail-date">è´­ä¹°äº {{selectedItem.purchaseDate}}</text>
            <text class="detail-price" wx:if="{{selectedItem.price}}">ğŸ’° {{selectedItem.price}}</text>
          </view>
        </view>
        
        <view class="item-description-full" wx:if="{{selectedItem.description}}">
          <text class="description-label">ç‰©å“æè¿°</text>
          <text class="description-content">{{selectedItem.description}}</text>
        </view>
        
        <view class="ai-description-section">
          <view class="ai-header">
            <text class="ai-title">âœ¨ AIé­”å¹»æè¿°</text>
            <rpg-button
              type="accent"
              text="{{selectedItem.aiDescription ? 'é‡æ–°ç”Ÿæˆ' : 'ç”Ÿæˆæè¿°'}}"
              size="small"
              bindtap="generateAIDescription"
              loading="{{generatingAI}}"
            />
          </view>
          
          <view class="ai-content" wx:if="{{selectedItem.aiDescription}}">
            <text class="ai-description">{{selectedItem.aiDescription}}</text>
          </view>
          
          <view class="ai-placeholder" wx:else>
            <text class="placeholder-text">ç‚¹å‡»æŒ‰é’®è®©AIä¸ºè¿™ä¸ªç‰©å“åˆ›é€ é­”å¹»çš„èƒŒæ™¯æ•…äº‹</text>
          </view>
        </view>
      </view>
      
      <view class="modal-actions">
        <rpg-button
          type="secondary"
          text="åˆ é™¤ç‰©å“"
          size="small"
          bindtap="deleteItem"
        />
        <rpg-button
          type="primary"
          text="å…³é—­"
          size="small"
          bindtap="closeDetailModal"
        />
      </view>
    </view>
  </view>
</view>
